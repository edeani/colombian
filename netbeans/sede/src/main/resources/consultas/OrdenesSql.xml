<?xml version="1.0" encoding="UTF-8"?>
<queries>
    <query id="OrdenesSql.totalOrdenesXFecha">
        select case when total_orden is null then 0 else total_orden end as total_orden from(
        select sum(o.valor_total) as total_orden 
        from orden o 
        where o.fecha_orden between :fechaInicial and :fechaFinal and o.estado_orden='A'
        )sub
    </query>
    <query id="OrdenesSql.ordenesReporteClientes">
    SELECT sub0.*,sub0.valor_producto*sub0.unidades AS valorTotal FROM(
    SELECT CAST(max(c.numero_telefono) AS CHAR(25)) AS telefono,   
         max(c.descripcion_cliente) as nombreCliente,   
         c.codigo_barrio as codigoBarrio,   
         SUM(dot.numero_unidades) AS unidades,
         p.descripcion_producto as nombreProducto,   
         ppi.codigo_producto as codigoProducto,
         dot.valor_producto
    FROM clientes c
    INNER JOIN orden o ON o.numero_telefono = c.numero_telefono
    INNER JOIN detalle_orden dot ON dot.numero_orden = o.numero_orden
    INNER JOIN producto_por_inventario ppi ON ppi.codigo_producto = dot.codigo_producto
    INNER JOIN productos p ON p.codigo_producto = ppi.codigo_producto   
    WHERE o.estado_orden = 'A' AND  
         o.fecha_orden between :fechaInicial and :fechaFinal
         AND c.numero_telefono = :tel
    GROUP BY c.numero_telefono,ppi.codigo_producto,p.descripcion_producto, dot.valor_producto
    ORDER BY c.descripcion_cliente,c.numero_telefono
    )sub0
    </query>
</queries>